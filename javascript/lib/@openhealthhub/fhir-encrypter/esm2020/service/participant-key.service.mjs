import { STRUCTURE_DEFINITION_URL } from '../util/fhir-constants';
export const PARTICIPANT_PUBLIC_KEY_UUID_SYSTEM = 'urn:ietf:rfc:3986';
export const PARTICIPANT_PUBLIC_KEY_URL = `${STRUCTURE_DEFINITION_URL}participant-program-public-key`;
export class ParticipantKeyService {
    toParticipantKey(practitioner) {
        if (!practitioner.id) {
            throw new Error('public key resource author should have an id');
        }
        const keyUuid = practitioner.identifier?.find(i => i.system === PARTICIPANT_PUBLIC_KEY_UUID_SYSTEM)?.value;
        if (!keyUuid) {
            throw new Error('public key resource author should contain a key uuid as identifier');
        }
        const publicKey = practitioner.extension?.find(ext => ext.url === PARTICIPANT_PUBLIC_KEY_URL)?.valueString;
        if (!publicKey) {
            throw new Error('public key resource should have an extension containing the actual public key value');
        }
        return {
            keyUuid,
            practitioner,
            publicKey,
            userUuid: practitioner.id
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljaXBhbnQta2V5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL3NlcnZpY2UvcGFydGljaXBhbnQta2V5LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFDLHdCQUF3QixFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFFaEUsTUFBTSxDQUFDLE1BQU0sa0NBQWtDLEdBQUcsbUJBQW1CLENBQUM7QUFDdEUsTUFBTSxDQUFDLE1BQU0sMEJBQTBCLEdBQUcsR0FBRyx3QkFBd0IsZ0NBQWdDLENBQUM7QUFFdEcsTUFBTSxPQUFPLHFCQUFxQjtJQUNoQyxnQkFBZ0IsQ0FBQyxZQUEwQjtRQUN6QyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRTtZQUNwQixNQUFNLElBQUksS0FBSyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7U0FDakU7UUFFRCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssa0NBQWtDLENBQUMsRUFBRSxLQUFLLENBQUM7UUFDM0csSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsb0VBQW9FLENBQUMsQ0FBQztTQUN2RjtRQUVELE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSywwQkFBMEIsQ0FBQyxFQUFFLFdBQVcsQ0FBQztRQUMzRyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxxRkFBcUYsQ0FBQyxDQUFDO1NBQ3hHO1FBRUQsT0FBTztZQUNMLE9BQU87WUFDUCxZQUFZO1lBQ1osU0FBUztZQUNULFFBQVEsRUFBRSxZQUFZLENBQUMsRUFBRTtTQUMxQixDQUFDO0lBQ0osQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtQcmFjdGl0aW9uZXJ9IGZyb20gJ2ZoaXIvcjQnO1xuaW1wb3J0IHtQcmFjdGl0aW9uZXJLZXl9IGZyb20gJy4uL21vZGVscy9wcmFjdGl0aW9uZXIta2V5JztcbmltcG9ydCB7U1RSVUNUVVJFX0RFRklOSVRJT05fVVJMfSBmcm9tICcuLi91dGlsL2ZoaXItY29uc3RhbnRzJztcblxuZXhwb3J0IGNvbnN0IFBBUlRJQ0lQQU5UX1BVQkxJQ19LRVlfVVVJRF9TWVNURU0gPSAndXJuOmlldGY6cmZjOjM5ODYnO1xuZXhwb3J0IGNvbnN0IFBBUlRJQ0lQQU5UX1BVQkxJQ19LRVlfVVJMID0gYCR7U1RSVUNUVVJFX0RFRklOSVRJT05fVVJMfXBhcnRpY2lwYW50LXByb2dyYW0tcHVibGljLWtleWA7XG5cbmV4cG9ydCBjbGFzcyBQYXJ0aWNpcGFudEtleVNlcnZpY2Uge1xuICB0b1BhcnRpY2lwYW50S2V5KHByYWN0aXRpb25lcjogUHJhY3RpdGlvbmVyKTogUHJhY3RpdGlvbmVyS2V5IHtcbiAgICBpZiAoIXByYWN0aXRpb25lci5pZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwdWJsaWMga2V5IHJlc291cmNlIGF1dGhvciBzaG91bGQgaGF2ZSBhbiBpZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGtleVV1aWQgPSBwcmFjdGl0aW9uZXIuaWRlbnRpZmllcj8uZmluZChpID0+IGkuc3lzdGVtID09PSBQQVJUSUNJUEFOVF9QVUJMSUNfS0VZX1VVSURfU1lTVEVNKT8udmFsdWU7XG4gICAgaWYgKCFrZXlVdWlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3B1YmxpYyBrZXkgcmVzb3VyY2UgYXV0aG9yIHNob3VsZCBjb250YWluIGEga2V5IHV1aWQgYXMgaWRlbnRpZmllcicpO1xuICAgIH1cblxuICAgIGNvbnN0IHB1YmxpY0tleSA9IHByYWN0aXRpb25lci5leHRlbnNpb24/LmZpbmQoZXh0ID0+IGV4dC51cmwgPT09IFBBUlRJQ0lQQU5UX1BVQkxJQ19LRVlfVVJMKT8udmFsdWVTdHJpbmc7XG4gICAgaWYgKCFwdWJsaWNLZXkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncHVibGljIGtleSByZXNvdXJjZSBzaG91bGQgaGF2ZSBhbiBleHRlbnNpb24gY29udGFpbmluZyB0aGUgYWN0dWFsIHB1YmxpYyBrZXkgdmFsdWUnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAga2V5VXVpZCxcbiAgICAgIHByYWN0aXRpb25lcixcbiAgICAgIHB1YmxpY0tleSxcbiAgICAgIHVzZXJVdWlkOiBwcmFjdGl0aW9uZXIuaWRcbiAgICB9O1xuICB9XG59XG4iXX0=